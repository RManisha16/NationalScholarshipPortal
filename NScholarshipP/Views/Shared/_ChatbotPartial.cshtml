<!-- Floating Chat Icon -->
<button id="chatbot-toggle" class="chatbot-float-btn" aria-label="Chat with NSP bot">

    💬
</button>

<!-- Chat Window -->
<div id="chatbot-window" class="chatbot-window" aria-hidden="true">
    <div class="chatbot-header bg-success text-white">
        <span>NSP Chatbot 🤖</span>
        <button id="chatbot-close" class="btn-close-white">×</button>
    </div>

    <div id="chatbot-body" class="chatbot-body">
        <div class="bot-message">Hi 👋 I'm the NSP Chatbot! How can I help you?</div>
    </div>

    <div class="chatbot-input">
        <input id="chatbot-text" type="text" placeholder="Type your question..." />
        <button id="chatbot-send">Send</button>
    </div>
</div>

<style>

    /* === Floating button === */

    .chatbot-float-btn {
        position: fixed;
        bottom: 25px;
        right: 25px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #198754;
        color: #fff;
        font-size: 24px;
        border: none;
        cursor: pointer;
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transition: transform 0.2s ease, background 0.2s ease;
    }

        .chatbot-float-btn:hover {
            background: #157347;
            transform: scale(1.1);
        }

    /* === Chat window === */

    .chatbot-window {
        position: fixed;
        bottom: 100px;
        right: 25px;
        width: 330px;
        height: 420px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 9998;
        animation: fadeIn 0.25s ease;
    }

        .chatbot-window.show {
            display: flex;
        }

    @@keyframes fadeIn {

        from {
            opacity: 0;
            transform: scale(0.9);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* === Header === */

    .chatbot-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: #198754;
        color: white;
        font-weight: 600;
    }

        .chatbot-header .btn-close-white {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

    /* === Body === */

    .chatbot-body {
        flex: 1;
        background: #f8f9fa;
        padding: 10px;
        overflow-y: auto;
    }

    .bot-message, .user-message {
        margin: 6px 0;
        padding: 8px 12px;
        border-radius: 12px;
        max-width: 80%;
    }

    .bot-message {
        background: #e9f7ef;
        color: #064420;
        align-self: flex-start;
    }

    .user-message {
        background: #198754;
        color: #fff;
        align-self: flex-end;
        margin-left: auto;
    }

    /* === Input === */

    .chatbot-input {
        display: flex;
        gap: 5px;
        padding: 10px;
        border-top: 1px solid #ddd;
        background: #fff;
    }

        .chatbot-input input {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .chatbot-input button {
            background: #198754;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }

            .chatbot-input button:hover {
                background: #157347;
            }
</style>

<script>

    document.addEventListener("DOMContentLoaded", function () {

        const toggleBtn = document.getElementById("chatbot-toggle");

        const chatWindow = document.getElementById("chatbot-window");

        const closeBtn = document.getElementById("chatbot-close");

        const sendBtn = document.getElementById("chatbot-send");

        const input = document.getElementById("chatbot-text");

        const body = document.getElementById("chatbot-body");

        // ✅ Toggle open/close

        toggleBtn.addEventListener("click", () => {

            chatWindow.classList.toggle("show");

        });

        closeBtn.addEventListener("click", () => {

            chatWindow.classList.remove("show");

        });

        // ✅ Append message

        function appendMessage(msg, cls) {

            const div = document.createElement("div");

            div.classList.add(cls);

            div.innerText = msg;

            body.appendChild(div);

            body.scrollTop = body.scrollHeight;

        }

        // ✅ Send message

        function sendMessage() {

            const text = input.value.trim();

            if (!text) return;

            appendMessage(text, "user-message");

            input.value = "";

            fetch("/Chatbot/GetResponse", {

                method: "POST",

                headers: { "Content-Type": "application/x-www-form-urlencoded" },

                body: new URLSearchParams({ userMessage: text })

            })

            .then(res => res.json())

            .then(data => appendMessage(data.response, "bot-message"))

            .catch(() => appendMessage("Sorry, I couldn’t reach the server.", "bot-message"));

        }

        sendBtn.addEventListener("click", sendMessage);

        input.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });

    });
</script>

