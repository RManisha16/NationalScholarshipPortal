@model NScholarshipP.Models.StudentProfileViewModel
@{
    ViewData["Title"] = "My Profile";
    var success = TempData["Success"] as string;
    var error = TempData["Error"] as string;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<style>
    body {
        background-color: #f8fafc;
        font-family: "Poppins", sans-serif;
    }

    .profile-wrapper {
        max-width: 750px;
        margin: 40px auto;
        background: #fff;
        border-radius: 12px;
        border: 1px solid #e5e9f2;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
        overflow: hidden;
    }

    .profile-header {
        text-align: center;
        background-color: #0d6efd;
        color: white;
        padding: 30px 20px;
    }

        .profile-header h4 {
            margin-bottom: 4px;
            font-weight: 600;
        }

        .profile-header small {
            opacity: 0.85;
        }

    .profile-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 3px solid #fff;
        object-fit: cover;
        margin-top: -60px;
        background: #fff;
    }

    .profile-body {
        padding: 25px;
        text-align: center;
    }

    .info-box {
        text-align: left;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
    }

    .info-item {
        background: #f9fbfd;
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid #edf2f7;
    }

        .info-item label {
            display: block;
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 3px;
        }

        .info-item div {
            font-weight: 600;
            color: #1a1a1a;
        }

    .quick-links {
        margin-top: 25px;
    }

        .quick-links a {
            margin: 4px;
            border-radius: 8px;
            padding: 8px 14px;
            font-weight: 500;
        }

    .alert {
        border-radius: 8px;
        margin-top: 15px;
    }

    @@media (max-width: 576px) {
        .info-box

    {
        grid-template-columns: 1fr;
    }

    }
</style>

<div class="profile-wrapper">
    <div class="profile-header">
        <h4>Student Profile</h4>
        <small>Manage your personal and scholarship details</small>
    </div>

    <div class="profile-body">
        <img id="profilePreview"
             src="@Url.Content(Model.PhotoPath ?? "/Images/default.jpg")"
             class="profile-photo"
             alt="Profile Photo" />

        <div class="mt-2 d-flex justify-content-center gap-2">
            <button class="btn btn-light btn-sm border rounded-circle shadow-sm"
                    type="button"
                    onclick="document.getElementById('photoInput').click()"
                    title="Change Photo">
                <i class="bi bi-camera text-primary"></i>
            </button>

            <form asp-action="RemoveProfilePicture" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit"
                        class="btn btn-outline-danger btn-sm rounded-circle"
                        title="Remove Photo"
                        onclick="return confirm('Remove your profile photo?');">
                    <i class="bi bi-trash"></i>
                </button>
            </form>
        </div>

        <form asp-action="UploadProfilePicture" method="post" enctype="multipart/form-data" id="autoUploadForm">
            @Html.AntiForgeryToken()
            <input type="file" name="photo" id="photoInput" accept="image/*" class="d-none" />
        </form>

        @if (!string.IsNullOrEmpty(success))
        {
            <div class="alert alert-success">@success</div>
        }
        @if (!string.IsNullOrEmpty(error))
        {
            <div class="alert alert-danger">@error</div>
        }

        <div class="info-box">
            <div class="info-item">
                <label>Full Name</label>
                <div>@Model.FullName</div>
            </div>
            <div class="info-item">
                <label>Email</label>
                <div>@Model.Email</div>
            </div>
            <div class="info-item">
                <label>Total Applications</label>
                <div>@Model.TotalApplications</div>
            </div>
            <div class="info-item">
                <label>Approved</label>
                <div class="text-success">@Model.ApprovedCount</div>
            </div>
            <div class="info-item">
                <label>Pending</label>
                <div class="text-warning">@Model.PendingCount</div>
            </div>
            <div class="info-item">
                <label>Last Application Date</label>
                <div>@(Model.LastApplicationDate?.ToString("dd MMM yyyy") ?? "N/A")</div>
            </div>
        </div>

        <div class="quick-links">
            <a asp-controller="Student" asp-action="Dashboard" class="btn btn-outline-primary">
                <i class="bi bi-speedometer2"></i> <strong>Dashboard</strong>
            </a>
            <a asp-controller="Student" asp-action="Logout" class="btn btn-outline-danger">
                <i class="bi bi-box-arrow-right"></i> <strong>Logout</strong>
            </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

@section Scripts {
    <script>
        const input = document.getElementById('photoInput');
        const form = document.getElementById('autoUploadForm');
        input.addEventListener('change', e => {
            const file = e.target.files && e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file.');
                e.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = ev => document.getElementById('profilePreview').src = ev.target.result;
            reader.readAsDataURL(file);
            form.submit();
        });
    </script>
}
